# astrbot_plugin_enhanced_memoryï¼ˆå¯èƒ½ä¸å¤ªå¥½ç”¨ï¼‰
âš™ï¸ ç¯å¢ƒé…ç½®
å¿…éœ€ä¾èµ–
bash
# åŸºç¡€ä¾èµ–ï¼ˆå¿…éœ€ï¼‰
pip install jieba pydantic
å¢å¼ºä¾èµ–ï¼ˆæ¨èå®‰è£…ï¼‰
bash
# è¯­ä¹‰æœç´¢åŠŸèƒ½
pip install faiss-cpu sentence-transformers

# è®°å¿†å›¾è°±åŠŸèƒ½  
pip install networkx

# AIæ¢³ç†åŠŸèƒ½ï¼ˆéœ€è¦LLMæä¾›å•†ï¼‰
pip install transformers torch
å®Œæ•´ä¸€é”®å®‰è£…
bash
pip install jieba pydantic faiss-cpu sentence-transformers networkx transformers torch
ğŸ”§ AstrBoté…ç½®
1. å¯ç”¨æ’ä»¶
å¯åŠ¨AstrBot

è®¿é—®WebUI (é€šå¸¸æ˜¯ http://localhost:8000)

è¿›å…¥"æ’ä»¶ç®¡ç†"

æ‰¾åˆ°"å¢å¼ºè®°å¿†æ’ä»¶ v3.0"

ç‚¹å‡»"å¯ç”¨"

2. é…ç½®LLMæä¾›å•†ï¼ˆAIæ¢³ç†åŠŸèƒ½å¿…éœ€ï¼‰
è¿›å…¥"è®¾ç½®" â†’ "AIæä¾›å•†"

æ·»åŠ ä½ å–œæ¬¢çš„LLMæä¾›å•†ï¼š

OpenAI GPTç³»åˆ—

Azure OpenAI

å…¶ä»–å…¼å®¹çš„LLMæœåŠ¡

é…ç½®APIå¯†é’¥å’Œå‚æ•°

ä¿å­˜é…ç½®

3. æ’ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰
åœ¨æ’ä»¶é…ç½®é¡µé¢å¯ä»¥è°ƒæ•´ï¼š

å­˜å‚¨è·¯å¾„: è®°å¿†æ•°æ®ä¿å­˜ä½ç½®

è‡ªåŠ¨æå–: æ˜¯å¦ä»å¯¹è¯è‡ªåŠ¨æå–è®°å¿†

AIæ¢³ç†: å¯ç”¨æ™ºèƒ½è®°å¿†æ•´ç†

æœç´¢è®¾ç½®: æœç´¢ç»“æœæ•°é‡å’Œæœç´¢æ–¹å¼

ğŸš€ åŸºç¡€ä½¿ç”¨
1. æ·»åŠ è®°å¿†
bash
# åŸºç¡€æ·»åŠ 
/memo_add "ç”¨æˆ·å–œæ¬¢è“è‰²"

# å¸¦é‡è¦æ€§è¯„åˆ†
/memo_add "ç”¨æˆ·æ˜¯ç¨‹åºå‘˜" --importance 0.8

# æŒ‡å®šç±»å‹
/memo_add "æ˜å¤©è¦å¼€ä¼š" --type event
2. æœç´¢è®°å¿†
bash
# åŸºç¡€æœç´¢
/memo_search "é¢œè‰²"

# é™åˆ¶ç»“æœæ•°é‡
/memo_search "å·¥ä½œ" 10

# è¯­ä¹‰æœç´¢ï¼ˆéœ€è¦sentence-transformersï¼‰
/memo_search "ç¼–ç¨‹ç›¸å…³" --use_semantic
3. ç®¡ç†è®°å¿†
bash
# æŸ¥çœ‹ç»Ÿè®¡
/memo_stats

# åˆ é™¤è®°å¿†ï¼ˆéœ€è¦è®°å¿†IDï¼‰
/memo_delete "è®°å¿†ID"

# å…³è”è®°å¿†
/memo_associate "è®°å¿†ID1" "è®°å¿†ID2"
ğŸ¤– é«˜çº§åŠŸèƒ½
AIæ™ºèƒ½æ¢³ç†
bash
# å…¨é¢æ¢³ç†è®°å¿†åº“
/memo_organize all

# æŒ‡å®šä»»åŠ¡æ¢³ç†
/memo_organize categorize,suggest_associations

# ä½¿ç”¨ç‰¹å®šæ¨¡å‹
/memo_organize all model_id=your_model_id

# åº”ç”¨æ¢³ç†å»ºè®®
/memo_apply_org
æ•°æ®ç®¡ç†
bash
# å¯¼å‡ºè®°å¿†ï¼ˆJSONæ ¼å¼ï¼‰
/memo_export json

# å¯¼å‡ºè®°å¿†ï¼ˆCSVæ ¼å¼ï¼‰
/memo_export csv

# å¯¼å…¥è®°å¿†
/memo_import "è·¯å¾„/è®°å¿†æ–‡ä»¶.json"
ç³»ç»Ÿä¿¡æ¯
bash
# æ£€æŸ¥ä¾èµ–çŠ¶æ€
/memo_deps

# æŸ¥çœ‹å¯ç”¨AIæ¨¡å‹
/memo_models

# æ˜¾ç¤ºå®Œæ•´å¸®åŠ©
/memo_help
ğŸ’¡ ä½¿ç”¨æŠ€å·§
1. è‡ªåŠ¨åŒ–è®°å¿†æå–
æ’ä»¶ä¼šè‡ªåŠ¨ä»å¯¹è¯ä¸­æå–é‡è¦ä¿¡æ¯

åŒ…å«ä¸ªäººä¿¡æ¯ã€åå¥½ã€äº‹å®ç­‰å†…å®¹

å¯é…ç½®æå–æ•æ„Ÿåº¦

2. æ™ºèƒ½å…³è”å»ºç«‹
è‡ªåŠ¨åŸºäºå…³é”®è¯ç›¸ä¼¼åº¦å»ºç«‹è®°å¿†å…³è”

æ”¯æŒæ‰‹åŠ¨å»ºç«‹ç‰¹å®šå…³è”

å…³è”è®°å¿†ä¼šåœ¨æœç´¢æ—¶ä¸€å¹¶æ˜¾ç¤º

3. AIæ¢³ç†æœ€ä½³å®è·µ
bash
# å®šæœŸæ¢³ç†ä¿æŒè®°å¿†åº“æ•´æ´
/memo_organize all

# å…ˆé¢„è§ˆå†åº”ç”¨
/memo_organize categorize
/memo_apply_org

# é’ˆå¯¹æ€§æ¢³ç†ç‰¹å®šé—®é¢˜
/memo_organize find_duplicates
ğŸ¯ å®æˆ˜ç¤ºä¾‹
åœºæ™¯ä¸€ï¼šä¸ªäººåŠ©ç†
bash
# è®°å½•ç”¨æˆ·åå¥½
/memo_add "ç”¨æˆ·ä¸å–œæ¬¢åƒè¾£"
/memo_add "ç”¨æˆ·æ¯å¤©æ—©9ç‚¹ä¸Šç­"

# æœç´¢ç›¸å…³ä¿¡æ¯
/memo_search "é¥®é£Ÿåå¥½"
/memo_search "å·¥ä½œæ—¶é—´"
åœºæ™¯äºŒï¼šçŸ¥è¯†ç®¡ç†
bash
# æ·»åŠ æŠ€æœ¯çŸ¥è¯†
/memo_add "Pythonçš„GILæ˜¯å…¨å±€è§£é‡Šå™¨é”"
/memo_add "JavaScriptæ˜¯å•çº¿ç¨‹è¯­è¨€"

# å»ºç«‹çŸ¥è¯†å…³è”
/memo_associate "è®°å¿†ID1" "è®°å¿†ID2"

# AIæ¢³ç†çŸ¥è¯†ç»“æ„
/memo_organize categorize,suggest_associations
åœºæ™¯ä¸‰ï¼šé¡¹ç›®è·Ÿè¸ª
bash
# è®°å½•é¡¹ç›®ä¿¡æ¯
/memo_add "é¡¹ç›®Aéœ€è¦åœ¨å‘¨äº”å‰å®Œæˆ"
/memo_add "å®¢æˆ·å¯¹UIé¢œè‰²æœ‰ç‰¹æ®Šè¦æ±‚"

# å¯¼å‡ºé¡¹ç›®è®°å¿†
/memo_export json
ğŸ” æ•…éšœæ’é™¤
å¸¸è§é—®é¢˜
Q: æ’ä»¶æ— æ³•åŠ è½½

text
A: æ£€æŸ¥ï¼š
1. æ’ä»¶ç›®å½•æ˜¯å¦æ­£ç¡®ï¼šAstrBot/data/plugins/astrbot_plugin_enhanced_memory
2. ä¾èµ–æ˜¯å¦å®‰è£…ï¼špip install jieba pydantic
3. æŸ¥çœ‹AstrBotæ—¥å¿—æ–‡ä»¶
Q: AIæ¢³ç†åŠŸèƒ½ä¸å¯ç”¨

text
A: æ£€æŸ¥ï¼š
1. LLMæä¾›å•†æ˜¯å¦é…ç½®æ­£ç¡®
2. APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
Q: è¯­ä¹‰æœç´¢ä¸å·¥ä½œ

text
A: å®‰è£…ä¾èµ–ï¼š
pip install faiss-cpu sentence-transformers
Q: è®°å¿†æ•°æ®ä¸¢å¤±

text
A: æ•°æ®å­˜å‚¨åœ¨ï¼šdata/plugin_data/enhanced_memory/
å®šæœŸä½¿ç”¨ /memo_export å¤‡ä»½æ•°æ®
æ—¥å¿—æ£€æŸ¥
æŸ¥çœ‹AstrBotæ—¥å¿—äº†è§£è¯¦ç»†çŠ¶æ€ï¼š

bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f AstrBot/logs/astrbot.log

# æœç´¢æ’ä»¶ç›¸å…³æ—¥å¿—
grep "enhanced_memory" AstrBot/logs/astrbot.log

ğŸ“Š åŠŸèƒ½å¯¹æ¯”

åŠŸèƒ½	åŸºç¡€ç‰ˆ	å¢å¼ºç‰ˆ	å®Œæ•´ç‰ˆ

åŸºç¡€è®°å¿†ç®¡ç†	âœ…	âœ…	âœ…

è‡ªåŠ¨è®°å¿†æå–	âœ…	âœ…	âœ…

å…³é”®è¯æœç´¢	    âœ…	âœ…	âœ…

è¯­ä¹‰å‘é‡æœç´¢	âŒ	âœ…	âœ…

è®°å¿†å…³è”        âŒ	âœ…	âœ…

AIæ™ºèƒ½æ¢³ç†	    âŒ	âœ…	âœ…

æ•°æ®å¯¼å…¥å¯¼å‡º	âŒ	âœ…	âœ…

å¤šæ¨¡å‹æ”¯æŒ	    âŒ	âŒ	âœ…

ğŸ‰ è¿›é˜¶æŠ€å·§
1. æ‰¹é‡æ“ä½œ

# å¯ä»¥é€šè¿‡è„šæœ¬æ‰¹é‡å¯¼å…¥è®°å¿†

import json

memories = {

    "è®°å¿†1": {"content": "å†…å®¹1", "type": "fact"},
    
    "è®°å¿†2": {"content": "å†…å®¹2", "type": "preference"}
    
}

with open("batch_import.json", "w") as f:

    json.dump(memories, f)
    
# ç„¶åä½¿ç”¨ /memo_import å¯¼å…¥

2. è‡ªå®šä¹‰é…ç½®
   
åœ¨ _conf_schema.json ä¸­å¯ä»¥è‡ªå®šä¹‰ï¼š

è®°å¿†åˆ†ç±»ç±»å‹

è‡ªåŠ¨æå–è§„åˆ™

æœç´¢å‚æ•°

AIæ¢³ç†ä»»åŠ¡

3. é›†æˆå·¥ä½œæµ
å°†è®°å¿†æ’ä»¶ä¸å…¶ä»–æ’ä»¶ç»“åˆï¼š

ä¸ä»»åŠ¡ç®¡ç†æ’ä»¶è”åŠ¨

ä¸æ—¥ç¨‹å®‰æ’æ’ä»¶é›†æˆ

ä½œä¸ºAIå¯¹è¯çš„é•¿æœŸè®°å¿†åº“

é˜ˆå€¼è°ƒæ•´å»ºè®®
0.1-0.3: å®½æ¾æ¨¡å¼ - æå–æ›´å¤šè®°å¿†

0.3-0.5: å¹³è¡¡æ¨¡å¼ - æ¨èè®¾ç½®

0.5-0.7: ä¸¥æ ¼æ¨¡å¼ - åªæå–é‡è¦ä¿¡æ¯

0.7-1.0: æä¸¥æ ¼ - åŸºæœ¬åªæå–å…³é”®ä¿¡æ¯

ğŸ” å…³é”®è¯è¯†åˆ«

# ä¸ªäººä¿¡æ¯è¯†åˆ«
personal_indicators = ["æˆ‘", "æˆ‘çš„", "è‡ªå·±", "ä¸ªäºº"]

# åå¥½ä¿¡æ¯è¯†åˆ«  
preference_indicators = ["å–œæ¬¢", "è®¨åŒ", "çˆ±", "æ¨", "åå¥½", "ä¹ æƒ¯"]

# äº‹å®ä¿¡æ¯è¯†åˆ«
fact_indicators = ["æ˜¯", "æœ‰", "åœ¨", "å±äº", "çŸ¥é“", "è®°å¾—"]

# æ—¶é—´ä¿¡æ¯è¯†åˆ«
time_indicators = ["æ˜¨å¤©", "ä»Šå¤©", "æ˜å¤©", "ä¸Šå‘¨", "å»å¹´"]

ğŸ“Š é‡è¦æ€§è¯„åˆ†ç®—æ³•

def _calculate_importance(self, message: str, conversation_history: List[Dict] = None) -> float:
    importance = 0.1  # åŸºç¡€åˆ†
    
    # ç»´åº¦åŠ åˆ†
    +0.3  # åŒ…å«ä¸ªäººä¿¡æ¯
    +0.4  # åŒ…å«åå¥½ä¿¡æ¯  
    +0.2  # åŒ…å«äº‹å®ä¿¡æ¯
    +0.2  # åŒ…å«æ—¶é—´ä¿¡æ¯
    +0.3  # é‡è¦é—®é¢˜å›ç­”
    
    return min(importance, 1.0)  # ä¸Šé™1.0
3. è‡ªåŠ¨åˆ†ç±»ç³»ç»Ÿ
   
def _classify_message_type(self, message: str) -> str:

    if any(word in message for word in ['å–œæ¬¢', 'è®¨åŒ', 'çˆ±', 'æ¨', 'åå¥½']):
   
        return 'preference'      # ç”¨æˆ·åå¥½
   
    elif any(word in message for word in ['è®¤ä¸º', 'è§‰å¾—', 'æƒ³', 'åº”è¯¥']):
   
        return 'opinion'         # è§‚ç‚¹çœ‹æ³•
   
    elif any(word in message for word in ['æ˜¨å¤©', 'ä»Šå¤©', 'æ˜å¤©', 'å°æ—¶', 'åˆ†é’Ÿ']):
   
        return 'event'           # æ—¶é—´äº‹ä»¶
   
    elif any(word in message for word in ['æ˜¯', 'æœ‰', 'åœ¨', 'å±äº']):
   
        return 'fact'            # äº‹å®ä¿¡æ¯
   
    else:
   
        return 'other'           # å…¶ä»–ç±»å‹
   
âœ¨ ç°åœ¨å°±å¼€å§‹ä½¿ç”¨å¢å¼ºè®°å¿†æ’ä»¶ï¼Œæ‰“é€ å±äºä½ çš„æ™ºèƒ½è®°å¿†ç³»ç»Ÿï¼
# æ”¯æŒ

[å¸®åŠ©æ–‡æ¡£](https://astrbot.app)
